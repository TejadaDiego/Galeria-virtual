<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Contenido - Galer칤a Virtual</title>

  <!-- CSS correctos -->
  <link rel="stylesheet" href="Estilos/catalogo.css"/>
  <link rel="stylesheet" href="Estilos/Estilo.css"/>
  <link rel="stylesheet" href="Estilos/premium.css"/>

  <style>
      /* Tarjeta de trabajos de usuarios */
      .card-user {
          background:#1a1635;
          padding:15px;
          border-radius:10px;
          box-shadow:0 0 10px #0003;
          text-align:center;
          transition:0.3s;
      }
      .card-user img {
          width:100%;
          height:180px;
          object-fit:cover;
          border-radius:10px;
      }
      .card-user h3 { color:white; margin:8px 0; font-weight:700; }
      .card-user p { color:#bbb; margin:4px 0 10px; font-size:14px; }
      .card-user .precio { font-weight:bold; color:#b34cff; font-size:16px; }

      .btn-add {
          width:100%;
          padding:10px;
          margin-top:10px;
          background:#8e2cd6;
          color:white;
          border:none;
          border-radius:6px;
          cursor:pointer;
          font-weight:bold;
      }
      .btn-add:hover { background:#6a1bb8; }

      .btn-delete {
          width:100%;
          padding:10px;
          margin-top:8px;
          background:#d33;
          color:white;
          border:none;
          border-radius:6px;
          cursor:pointer;
          font-weight:bold;
      }
      .btn-delete:hover { background:#b11; }
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <nav class="navbar">
      <ul class="navbar-menu">
          <li><a href="inicio.html">Inicio</a></li>
          <li><a href="Sobre_nosotros.html">Nosotros</a></li>
          <li><a href="Contenido.html" class="active">Contenido</a></li>
          <li><a href="publicar.html">Publicar +</a></li>
      </ul>

      <div style="display:flex; align-items:center; gap:15px;">
          <div id="btnLoginHeader"><a href="login.html">Iniciar Sesi칩n</a></div>
          <div id="navbarUserBox"></div>

          <div class="cart-box" style="cursor:pointer;" onclick="location.href='carrito.html'">
              <span id="cartCount">0</span> 游
          </div>
      </div>
  </nav>

  <!-- T칈TULO -->
  <h1 class="titulo">Trabajos Destacados</h1>

  <!-- 10 PRODUCTOS FIJOS -->
  <div id="catalogo" class="grid">

    <div class="card">
      <img src="img/11.jpg" alt="Ilustraci칩n Digital">
      <h3>Ilustraci칩n Digital</h3>
      <p>Ilustraci칩n original en estilo digital, ideal para posters y portadas.</p>
      <div class="precio-carrito">
        <span class="precio">S/ 30.00</span>
        <button onclick="agregarAlCarrito(1, 'Ilustraci칩n Digital', 30, 'img/11.jpg')">游 A침adir</button>
      </div>
    </div>

    <div class="card">
      <img src="img/12.jpg" alt="Logo Minimalista">
      <h3>Logo Minimalista</h3>
      <p>Identidad visual minimal para marcas modernas.</p>
      <div class="precio-carrito">
        <span class="precio">S/ 45.00</span>
        <button onclick="agregarAlCarrito(2, 'Logo Minimalista', 45, 'img/12.jpg')">游 A침adir</button>
      </div>
    </div>

    <div class="card">
      <img src="img/13.jpg" alt="Retoque Fotogr치fico">
      <h3>Retoque Fotogr치fico</h3>
      <p>Edici칩n profesional y correcci칩n de color.</p>
      <div class="precio-carrito">
        <span class="precio">S/ 15.00</span>
        <button onclick="agregarAlCarrito(3, 'Retoque Fotogr치fico', 15, 'img/13.jpg')">游 A침adir</button>
      </div>
    </div>

    <div class="card">
      <img src="img/14.jpg" alt="Dise침o de Portada">
      <h3>Dise침o de Portada</h3>
      <p>Portadas para libros y 치lbumes.</p>
      <div class="precio-carrito">
        <span class="precio">S/ 35.00</span>
        <button onclick="agregarAlCarrito(4, 'Dise침o de Portada', 35, 'img/14.jpg')">游 A침adir</button>
      </div>
    </div>

    <div class="card">
      <img src="img/15.jpg" alt="Banner Publicitario">
      <h3>Banner Publicitario</h3>
      <p>Ideal para campa침as en redes sociales.</p>
      <div class="precio-carrito">
        <span class="precio">S/ 25.00</span>
        <button onclick="agregarAlCarrito(5, 'Banner Publicitario', 25, 'img/15.jpg')">游 A침adir</button>
      </div>
    </div>

    <div class="card">
      <img src="img/16.jpg" alt="Render 3D">
      <h3>Render 3D</h3>
      <p>Modelado y renderizado profesional.</p>
      <div class="precio-carrito">
        <span class="precio">S/ 55.00</span>
        <button onclick="agregarAlCarrito(6, 'Render 3D', 55, 'img/16.jpg')">游 A침adir</button>
      </div>
    </div>

    <div class="card">
      <img src="img/17.jpg" alt="Ilustraci칩n Anime">
      <h3>Ilustraci칩n Anime</h3>
      <p>Retratos personalizados en estilo anime.</p>
      <div class="precio-carrito">
        <span class="precio">S/ 40.00</span>
        <button onclick="agregarAlCarrito(7, 'Ilustraci칩n Anime', 40, 'img/17.jpg')">游 A침adir</button>
      </div>
    </div>

    <div class="card">
      <img src="img/18.jpg" alt="Edici칩n de Video">
      <h3>Edici칩n de Video</h3>
      <p>Edici칩n profesional para contenido multimedia.</p>
      <div class="precio-carrito">
        <span class="precio">S/ 60.00</span>
        <button onclick="agregarAlCarrito(8, 'Edici칩n de Video', 60, 'img/18.jpg')">游 A침adir</button>
      </div>
    </div>

    <div class="card">
      <img src="img/19.jpg" alt="Fotograf칤a Profesional">
      <h3>Fotograf칤a Profesional</h3>
      <p>Sesiones fotogr치ficas y postproducci칩n.</p>
      <div class="precio-carrito">
        <span class="precio">S/ 50.00</span>
        <button onclick="agregarAlCarrito(9, 'Fotograf칤a Profesional', 50, 'img/19.jpg')">游 A침adir</button>
      </div>
    </div>

    <div class="card">
      <img src="img/20.jpg" alt="Vectorizaci칩n">
      <h3>Vectorizaci칩n</h3>
      <p>Dise침os escalables de alta calidad.</p>
      <div class="precio-carrito">
        <span class="precio">S/ 20.00</span>
        <button onclick="agregarAlCarrito(10, 'Vectorizaci칩n', 20, 'img/20.jpg')">游 A침adir</button>
      </div>
    </div>

  </div>

  <!-- TITULO DINAMICO -->
  <h2 class="titulo">Trabajos Subidos por la Comunidad</h2>
  <div id="galeriaUser" class="grid"></div>

  <!-- SCRIPTS -->
  <script src="Scripts/carrito.js"></script>
  <script src="Scripts/sesion-global.js"></script>
  <script src="Scripts/script.js"></script>

  <!-- SCRIPT PARA CARGAR PUBLICACIONES DIN츼MICAS -->
  <script>

      const usuario = JSON.parse(localStorage.getItem("usuario"));

      async function cargarPublicaciones() {
          try {
              const res = await fetch("get_trabajos.php");
              const data = await res.json();

              const cont = document.getElementById("galeriaUser");
              cont.innerHTML = "";

              if (!Array.isArray(data) || data.length === 0) {
                  cont.innerHTML = "<p style='color:white;'>A칰n no hay trabajos publicados.</p>";
                  return;
              }

              data.forEach(t => {

                  let btnEliminar = "";
                  if (usuario && usuario.id == t.publicado_por) {
                      btnEliminar = `
                          <button class="btn-delete" onclick="eliminarTrabajo(${t.id}, this)">游딈 Eliminar</button>
                      `;
                  }

                  cont.innerHTML += `
                      <div class="card-user">
                          <img src="${t.imagen}">
                          <h3>${t.titulo}</h3>
                          <p>${t.descripcion}</p>
                          <p class="precio">S/ ${t.precio}</p>

                          <button class="btn-add"
                              onclick="agregarAlCarrito(${t.id}, '${t.titulo}', ${t.precio}, '${t.imagen}')">
                              游 A침adir
                          </button>

                          ${btnEliminar}
                      </div>
                  `;
              });

          } catch (err) {
              console.error(err);
          }
      }

      cargarPublicaciones();

      async function eliminarTrabajo(id, boton) {
          if (!confirm("쮼liminar este trabajo?")) return;

          const fd = new FormData();
          fd.append("id", id);

          const res = await fetch("eliminar_trabajo.php", {
              method: "POST",
              body: fd
          });

          const data = await res.json();

          if (data.success) {
              alert("Trabajo eliminado correctamente.");
              boton.closest(".card-user").remove();
          } else {
              alert("Error al eliminar: " + data.error);
          }
      }

  </script>

</body>
</html>
