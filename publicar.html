<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Publicar Trabajo - Galer√≠a Virtual</title>

  <!-- CSS DEL PROYECTO -->
  <link rel="stylesheet" href="Estilos/publicar.css">
  <link rel="stylesheet" href="Estilos/estilo.css">
  <link rel="stylesheet" href="Estilos/premium.css">

  <style>
    body { background:#0d0b1f; margin:0; font-family:Arial; }

    /* NAV */
    .navbar {
      width:100%;
      padding:20px;
      background:#0d0b1f;
      display:flex;
      justify-content:space-between;
      align-items:center;
      box-shadow:0 0 10px rgba(255,255,255,0.1);
      position:sticky;
      top:0;
      z-index:20;
    }

    .navbar-logo{
      font-size:22px;
      color:white;
      font-weight:bold;
    }

    .navbar-links{
      display:flex;
      gap:25px;
      align-items:center;
    }

    .navbar-links a{
      color:white;
      text-decoration:none;
      font-size:17px;
      transition:0.3s;
    }

    .navbar-links a:hover{
      color:#b34cff;
    }

    .navbar-links a.active{
      color:#b34cff;
      font-weight:bold;
    }

    #navbarUserBox img{
      width:45px;
      height:45px;
      border-radius:50%;
      border:2px solid #a569ff;
      object-fit:cover;
    }

    /* PREVIEW IMAGEN */
    #previewImg {
      width: 300px;
      height: auto;
      border-radius: 12px;
      border: 2px solid #a569ff;
      display: none;
      margin-top: 15px;
      box-shadow:0 0 10px rgba(165,105,255,0.5);
    }

    .form-container {
      max-width: 500px;
      margin: 40px auto;
      background:#1a1635;
      padding:25px;
      border-radius:15px;
      box-shadow:0 0 15px #000;
      color:white;
    }

    input, textarea {
      width:100%;
      padding:12px;
      margin-top:8px;
      border-radius:8px;
      border:none;
      background:#2c2850;
      color:white;
    }

    button {
      width:100%;
      padding:14px;
      margin-top:20px;
      background:#b34cff;
      color:white;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-size:16px;
      font-weight:bold;
      transition:0.3s;
    }

    button:hover {
      background:#8c32e6;
    }

  </style>
</head>

<body>

<!-- NAVBAR UNIFICADO -->
<nav class="navbar">

  <div class="navbar-logo">Galer√≠a Virtual</div>

  <div class="navbar-links">
      <a href="inicio.html">Inicio</a>
      <a href="Sobre_nosotros.html">Nosotros</a>
      <a href="Contenido.html">Contenido</a>
      <a href="publicar.html" class="active">Publicar +</a>
  </div>

  <div id="btnLoginHeader">
      <a href="login.html">Iniciar Sesi√≥n</a>
  </div>

  <div id="navbarUserBox"></div>

</nav>

<!-- FORMULARIO PUBLICAR -->
<div class="form-container">
  <h2>Publicar nuevo trabajo</h2>

  <form id="formPublicar" enctype="multipart/form-data">

    <label for="titulo">Nombre del trabajo:</label>
    <input type="text" id="titulo" name="titulo" required>

    <label for="descripcion">Descripci√≥n:</label>
    <textarea id="descripcion" name="descripcion" rows="4" required></textarea>

    <label for="precio">Precio (S/):</label>
    <input type="number" id="precio" name="precio" step="0.01" required>

    <label for="imagen">Imagen del trabajo:</label>
    <input type="file" id="imagen" name="imagen" accept="image/*" required>

    <img id="previewImg">

    <button type="submit">Subir trabajo</button>
  </form>
</div>

<!-- Scripts en orden correcto -->
<script src="Scripts/sesion-global.js?v=1"></script>
<script src="Scripts/script.js?v=1"></script>

<script>
/* ============================
   PREVIEW DE IMAGEN
============================ */
document.getElementById("imagen").addEventListener("change", function() {
    const file = this.files[0];
    const preview = document.getElementById("previewImg");

    if (file) {
        const reader = new FileReader();
        reader.onload = () => {
            preview.src = reader.result;
            preview.style.display = "block";
        };
        reader.readAsDataURL(file);
    }
});

/* ============================
   PUBLICAR TRABAJO
============================ */
document.getElementById("formPublicar").addEventListener("submit", async (e) => {
    e.preventDefault();

    const titulo = document.getElementById("titulo").value.trim();
    const descripcion = document.getElementById("descripcion").value.trim();
    const precio = document.getElementById("precio").value.trim();
    const imagen = document.getElementById("imagen").files[0];

    if (!titulo || !descripcion || !precio || !imagen) {
        alert("Por favor completa todos los campos.");
        return;
    }

    let formData = new FormData();
    formData.append("titulo", titulo);
    formData.append("descripcion", descripcion);
    formData.append("precio", precio);
    formData.append("imagen", imagen);

    try {
        const res = await fetch("publicar.php", {
            method: "POST",
            body: formData
        });

        const data = await res.json();

        if (!data.success) {
            alert("Error: " + data.error);
            return;
        }

        alert("üéâ Tu trabajo se ha subido con √©xito.");
        document.getElementById("formPublicar").reset();
        document.getElementById("previewImg").style.display = "none";

    } catch (err) {
        console.error(err);
        alert("Error al conectar con el servidor.");
    }
});
</script>

</body>
</html>
