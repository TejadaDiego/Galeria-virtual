<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi Cuenta - Galería Virtual</title>

    <link rel="stylesheet" href="Estilos/cuenta.css">

    <style>
        body {
            background:#0d0b1f;
            margin:0;
            font-family:Arial;
            color:white;
        }

        nav.navbar {
            width:100%;
            padding:20px;
            background:#0d0b1f;
            display:flex;
            justify-content:space-between;
            align-items:center;
            box-shadow:0 0 10px rgba(255,255,255,0.1);
        }

        .navbar-logo { font-size:22px; font-weight:bold; color:white; }
        .navbar-links { display:flex; gap:25px; }
        .navbar-links a { color:white; text-decoration:none; font-size:17px; }

        .cuenta-container {
            max-width:450px;
            margin:60px auto;
            padding:25px;
            background:#1a1635;
            border-radius:15px;
            box-shadow:0 0 15px #a569ff;
            text-align:center;
        }

        .foto-perfil {
            width:130px;
            height:130px;
            border-radius:50%;
            border:3px solid #a569ff;
            object-fit:cover;
            margin-bottom:15px;
        }

        input {
            width:100%;
            padding:12px;
            margin:10px 0;
            border:none;
            border-radius:8px;
            background:#2c2850;
            color:white;
        }

        button {
            width:100%;
            padding:12px;
            margin-top:12px;
            border:none;
            border-radius:8px;
            background:#b34cff;
            color:white;
            cursor:pointer;
            font-size:15px;
        }

        button:hover { background:#9d38e0; }
        .btn-salir { background:#d33 !important; }
        .btn-salir:hover { background:#b11 !important; }

        hr { border:1px solid #333; margin:25px 0; }
    </style>
</head>

<body>

    <!-- NAVBAR GLOBAL -->
    <nav class="navbar">
        <div class="navbar-logo">Galería Virtual</div>

        <div class="navbar-links">
            <a href="inicio.html">Inicio</a>
            <a href="Sobre_nosotros.html">Nosotros</a>
            <a href="Contenido.html">Contenido</a>
            <a href="publicar.html">Publicar</a>
        </div>

        <!-- Botón login -->
        <div id="btnLoginHeader">
            <a href="login.html">Iniciar Sesión</a>
        </div>

        <!-- Usuario -->
        <div id="navbarUserBox"></div>
    </nav>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="cuenta-container">

        <!-- FOTO Y DATOS -->
        <img id="fotoUser" class="foto-perfil" src="img/user.png">
        <h2 id="nombreUser">Usuario</h2>
        <p id="correoUser"></p>

        <button onclick="location.href='perfil.html'">Editar perfil</button>

        <hr>

        <!-- CAMBIAR CONTRASEÑA -->
        <h3>Cambiar contraseña</h3>

        <input type="password" id="passActual" placeholder="Contraseña actual">
        <input type="password" id="passNueva" placeholder="Nueva contraseña">
        <input type="password" id="passConfirm" placeholder="Confirmar nueva contraseña">

        <button id="btnCambiarPass">Actualizar contraseña</button>

        <button class="btn-salir" onclick="cerrarSesion()">Cerrar sesión</button>

    </div>

    <!-- SCRIPTS -->
    <script src="Scripts/sesion-global.js"></script>

    <script>
        // Obtener usuario real
        const user = JSON.parse(localStorage.getItem("usuario"));
        if (!user) window.location.href = "login.html";

        // Mostrar info
        document.getElementById("nombreUser").textContent = user.nombre;
        document.getElementById("correoUser").textContent = user.email;
        document.getElementById("fotoUser").src = user.foto ? "uploads/" + user.foto : "img/user.png";

        function cerrarSesion() {
            localStorage.removeItem("usuario");
            window.location.href = "login.html";
        }

        // CAMBIAR CONTRASEÑA
        document.getElementById("btnCambiarPass").addEventListener("click", async () => {

            const passActual = passActual.value.trim();
            const passNueva = passNueva.value.trim();
            const passConfirm = passConfirm.value.trim();

            if (!passActual || !passNueva || !passConfirm) {
                alert("Todos los campos son obligatorios.");
                return;
            }

            if (passNueva !== passConfirm) {
                alert("Las contraseñas nuevas no coinciden.");
                return;
            }

            const form = new FormData();
            form.append("accion", "cambiarPassword");
            form.append("id", user.id);
            form.append("passActual", passActual);
            form.append("passNueva", passNueva);

            try {
                const res = await fetch("cuenta.php", {
                    method:"POST",
                    body:form
                });

                const data = await res.json();

                if (data.status === "success") {
                    alert("Contraseña actualizada correctamente.");
                    passActual.value = "";
                    passNueva.value = "";
                    passConfirm.value = "";
                } else {
                    alert(data.message);
                }

            } catch (e) {
                console.error(e);
                alert("Error al conectar con el servidor.");
            }
        });
    </script>

</body>
</html>
