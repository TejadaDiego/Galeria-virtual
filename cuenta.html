<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi Cuenta</title>
    <link rel="stylesheet" href="Estilos/cuenta.css">
</head>

<body>

    <div class="cuenta-container">

        <h1>Mi Cuenta</h1>

        <!-- FOTO -->
        <img id="fotoPerfil" class="foto-perfil" src="Img/default.png">

        <button id="btnCambiarFoto">Cambiar foto</button>
        <input type="file" id="nuevaFoto" accept="image/*" style="display:none">

        <!-- NOMBRE -->
        <div class="input-group">
            <label>Nombre:</label>
            <input type="text" id="nuevoNombre">
        </div>

        <!-- CORREO →
             (solo lectura, nunca debe cambiarse aquí) -->
        <div class="input-group">
            <label>Correo:</label>
            <input type="text" id="correoUsuario" readonly>
        </div>

        <button id="guardarCambios" class="btn-guardar">Guardar cambios</button>

        <button class="btn-salir" onclick="cerrarSesion()">Cerrar sesión</button>

    </div>


<script>
// ───────────────────────────────────────────────
//  CARGAR DATOS AL ENTRAR
// ───────────────────────────────────────────────

document.addEventListener("DOMContentLoaded", () => {
    const user = JSON.parse(localStorage.getItem("usuarioActivo"));

    if (!user) {
        location.href = "login.html";
        return;
    }

    // Cargar datos actuales
    document.getElementById("fotoPerfil").src = user.foto || "Img/default.png";
    document.getElementById("nuevoNombre").value = user.nombre;
    document.getElementById("correoUsuario").value = user.correo;
});


// ───────────────────────────────────────────────
//  CAMBIAR FOTO
// ───────────────────────────────────────────────

document.getElementById("btnCambiarFoto").addEventListener("click", () => {
    document.getElementById("nuevaFoto").click();
});

document.getElementById("nuevaFoto").addEventListener("change", function () {
    const archivo = this.files[0];
    if (!archivo) return;

    // Limitar tamaño a 2MB por seguridad
    if (archivo.size > 2 * 1024 * 1024) {
        alert("La imagen es demasiado grande. Máximo 2MB.");
        return;
    }

    const lector = new FileReader();
    lector.onload = () => {
        let user = JSON.parse(localStorage.getItem("usuarioActivo"));
        user.foto = lector.result; // Guardar Base64

        // Guardar
        localStorage.setItem("usuarioActivo", JSON.stringify(user));

        // Mostrar nueva foto
        document.getElementById("fotoPerfil").src = lector.result;

        // Actualizar también navbar instantáneamente
        const navbarFoto = document.querySelector(".user-photo");
        if (navbarFoto) navbarFoto.src = lector.result;
    };

    lector.readAsDataURL(archivo);
});


// ───────────────────────────────────────────────
//  GUARDAR CAMBIOS
// ───────────────────────────────────────────────

document.getElementById("guardarCambios").addEventListener("click", () => {
    let user = JSON.parse(localStorage.getItem("usuarioActivo"));

    const nuevoNombre = document.getElementById("nuevoNombre").value.trim();

    if (nuevoNombre.length < 2) {
        alert("El nombre es demasiado corto.");
        return;
    }

    user.nombre = nuevoNombre;

    localStorage.setItem("usuarioActivo", JSON.stringify(user));

    // También actualizar nombre en navbar si está visible
    const navbarNombre = document.querySelector(".usuario-box span");
    if (navbarNombre) navbarNombre.textContent = nuevoNombre;

    alert("Cambios guardados correctamente");
});


// ───────────────────────────────────────────────
//  CERRAR SESIÓN
// ───────────────────────────────────────────────

function cerrarSesion() {
    localStorage.removeItem("usuarioActivo");
    location.href = "login.html";
}

</script>

</body>
</html>
