<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi Cuenta</title>
    <link rel="stylesheet" href="Estilos/cuenta.css">
</head>

<body>

<!-- NAVBAR UNIVERSAL -->
<nav class="navbar">
    <div class="navbar-logo">Galería Virtual</div>

    <div class="navbar-links">
        <a href="inicio.html">Inicio</a>
        <a href="Sobre_nosotros.html">Nosotros</a>
        <a href="Contenido.html">Contenido</a>
        <a href="publicar.html">Publicar +</a>

        <!-- Botón login -->
        <a id="btnLogin" href="login.html">Iniciar sesión</a>

        <!-- Contenedor usuario -->
        <div id="navbarUserBox" class="navbar-user-box"></div>
    </div>
</nav>


<!-- CONTENIDO PRINCIPAL -->
<div class="cuenta-container">

    <h1>Mi Cuenta</h1>

    <!-- FOTO -->
    <img id="fotoPerfil" class="foto-perfil" src="img/default.png">

    <button id="btnCambiarFoto">Cambiar foto</button>
    <input type="file" id="nuevaFoto" accept="image/*" style="display:none">

    <!-- NOMBRE -->
    <div class="input-group">
        <label>Nombre:</label>
        <input type="text" id="nuevoNombre">
    </div>

    <!-- CORREO -->
    <div class="input-group">
        <label>Correo:</label>
        <input type="text" id="correoUsuario" readonly>
    </div>

    <button id="guardarCambios" class="btn-guardar">Guardar cambios</button>

    <button class="btn-salir" onclick="cerrarSesion()">Cerrar sesión</button>

</div>


<script>
// ------------------------------------------------------
//  CARGAR DATOS DEL USUARIO
// ------------------------------------------------------
document.addEventListener("DOMContentLoaded", () => {
    const user = JSON.parse(localStorage.getItem("usuarioActivo"));

    if (!user) {
        location.href = "login.html";
        return;
    }

    // Cargar foto, nombre y correo
    document.getElementById("fotoPerfil").src = user.foto || "img/default.png";
    document.getElementById("nuevoNombre").value = user.nombre || "";
    document.getElementById("correoUsuario").value = user.correo || "";
});


// ------------------------------------------------------
//  CAMBIAR FOTO DE PERFIL
// ------------------------------------------------------
document.getElementById("btnCambiarFoto").addEventListener("click", () => {
    document.getElementById("nuevaFoto").click();
});

document.getElementById("nuevaFoto").addEventListener("change", function () {
    const archivo = this.files[0];
    if (!archivo) return;

    if (archivo.size > 2 * 1024 * 1024) {
        alert("La imagen es demasiado grande (máximo 2MB).");
        return;
    }

    const reader = new FileReader();
    reader.onload = () => {
        let user = JSON.parse(localStorage.getItem("usuarioActivo"));
        user.foto = reader.result;

        // Guardar nueva foto
        localStorage.setItem("usuarioActivo", JSON.stringify(user));

        // Actualizar foto en página
        document.getElementById("fotoPerfil").src = reader.result;

        // Actualizar foto en navbar
        const navFoto = document.querySelector("#navbarUserBox img");
        if (navFoto) navFoto.src = reader.result;

        alert("Foto actualizada correctamente.");
    };

    reader.readAsDataURL(archivo);
});


// ------------------------------------------------------
//  GUARDAR CAMBIO DE NOMBRE
// ------------------------------------------------------
document.getElementById("guardarCambios").addEventListener("click", () => {
    let user = JSON.parse(localStorage.getItem("usuarioActivo"));
    const nuevoNombre = document.getElementById("nuevoNombre").value.trim();

    if (nuevoNombre.length < 2) {
        alert("El nombre es demasiado corto.");
        return;
    }

    user.nombre = nuevoNombre;
    localStorage.setItem("usuarioActivo", JSON.stringify(user));

    // Actualizar nombre en navbar
    const navbarNombre = document.querySelector("#navbarUserBox span");
    if (navbarNombre) navbarNombre.textContent = nuevoNombre;

    alert("Datos actualizados correctamente.");
});


// ------------------------------------------------------
//  CERRAR SESIÓN
// ------------------------------------------------------
function cerrarSesion() {
    localStorage.removeItem("usuarioActivo");
    location.href = "login.html";
}
</script>

<script src="Scripts/sesion-global.js"></script>

</body>
</html>
