<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi Cuenta - educonnect</title>

    <style>
        body {
            background:#0d0b1f;
            margin:0;
            font-family:Arial;
            color:white;
        }

        /* NAVBAR */
        nav.navbar {
            width:100%;
            padding:20px;
            background:#0d0b1f;
            display:flex;
            justify-content:space-between;
            align-items:center;
            box-shadow:0 0 10px rgba(255,255,255,0.08);
            position:sticky;
            top:0;
            z-index:100;
        }

        .navbar-logo { font-size:22px; font-weight:bold; color:white; }
        .navbar-links { display:flex; gap:25px; }
        .navbar-links a { color:white; text-decoration:none; font-size:17px; }

        /* CONTENIDO CENTRADO TIPO PERFIL */
        .page-wrapper {
            width:100%;
            min-height:calc(100vh - 110px);
            display:flex;
            justify-content:center;
            align-items:flex-start;
            padding-top:40px;
        }

        /* TARJETA DE CUENTA (MISMO ESTILO QUE PERFIL) */
        .cuenta-container {
            width:420px;
            padding:30px;
            background:#1a1635;
            border-radius:20px;
            box-shadow:0 0 25px #a569ff7a;
            text-align:center;
            animation: fadeIn 0.45s ease-in-out;
        }

        /* ANIMACIÓN */
        @keyframes fadeIn {
            from { opacity:0; transform:translateY(25px); }
            to   { opacity:1; transform:translateY(0); }
        }

        .foto-perfil {
            width:140px;
            height:140px;
            border-radius:50%;
            border:3px solid #b34cff;
            object-fit:cover;
            margin-bottom:15px;
        }

        input {
            width:100%;
            padding:12px;
            margin:8px 0;
            border:none;
            border-radius:8px;
            background:#2c2850;
            color:white;
        }

        button {
            width:100%;
            padding:12px;
            margin-top:12px;
            border:none;
            border-radius:8px;
            background:#b34cff;
            color:white;
            cursor:pointer;
            font-size:15px;
            font-weight:bold;
        }

        button:hover { background:#9d38e0; }

        .btn-salir {
            background:#d33 !important;
        }

        .btn-salir:hover {
            background:#b11 !important;
        }

        hr {
            border:1px solid #3b3566;
            margin:25px 0;
        }
    </style>
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="navbar-logo">educonnect</div>

        <div class="navbar-links">
            <a href="inicio.html">Inicio</a>
            <a href="Sobre_nosotros.html">Nosotros</a>
            <a href="Contenido.html">Contenido</a>
            <a href="publicar.html">Publicar</a>
        </div>

        <div id="btnLoginHeader">
            <a href="login.html">Iniciar Sesión</a>
        </div>

        <div id="navbarUserBox"></div>
    </nav>

    <!-- CONTENEDOR CENTRAL -->
    <div class="page-wrapper">
        <div class="cuenta-container">

            <img id="fotoUser" class="foto-perfil" src="img/user.png">

            <h2 id="nombreUser">Usuario</h2>
            <p id="correoUser"></p>

            <button onclick="location.href='perfil.html'">Editar perfil</button>

            <hr>

            <h3>Cambiar contraseña</h3>

            <input type="password" id="passActual" placeholder="Contraseña actual">
            <input type="password" id="passNueva" placeholder="Nueva contraseña">
            <input type="password" id="passConfirm" placeholder="Confirmar nueva contraseña">

            <button id="btnCambiarPass">Actualizar contraseña</button>

            <button class="btn-salir" onclick="cerrarSesion()">Cerrar sesión</button>

        </div>
    </div>

    <!-- Sesión global -->
    <script src="Scripts/sesion-global.js"></script>

    <script>
        // Obtener usuario real
        const user = JSON.parse(localStorage.getItem("usuario"));
        if (!user) window.location.href = "login.html";

        // Cargar info
        document.getElementById("nombreUser").textContent = user.nombre;
        document.getElementById("correoUser").textContent = user.email;
        document.getElementById("fotoUser").src = user.foto ? "uploads/" + user.foto : "img/user.png";

        function cerrarSesion() {
            localStorage.removeItem("usuario");
            window.location.href = "login.html";
        }

        // CAMBIAR CONTRASEÑA
        document.getElementById("btnCambiarPass").addEventListener("click", async () => {

            const passActual = document.getElementById("passActual").value.trim();
            const passNueva = document.getElementById("passNueva").value.trim();
            const passConfirm = document.getElementById("passConfirm").value.trim();

            if (!passActual || !passNueva || !passConfirm) {
                alert("Completa todos los campos.");
                return;
            }

            if (passNueva !== passConfirm) {
                alert("Las contraseñas no coinciden.");
                return;
            }

            const form = new FormData();
            form.append("accion", "cambiarPassword");
            form.append("id", user.id);
            form.append("passActual", passActual);
            form.append("passNueva", passNueva);

            const res = await fetch("cuenta.php", { method:"POST", body:form });
            const data = await res.json();

            if (data.status === "success") {
                alert("Contraseña actualizada correctamente.");
                passActual.value = "";
                passNueva.value = "";
                passConfirm.value = "";
            } else {
                alert(data.message);
            }
        });
    </script>

</body>
</html>
