<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi Cuenta</title>
    <link rel="stylesheet" href="Estilos/cuenta.css">

    <style>
        /* ESTILOS DEL NAVBAR UNIVERSAL */
        .navbar {
            width: 100%;
            padding: 18px 30px;
            background: #0d0b1f;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .navbar-logo {
            color: white;
            font-size: 22px;
            font-weight: bold;
        }
        .navbar-links {
            display: flex;
            gap: 25px;
            align-items: center;
        }
        .navbar-links a {
            color: white;
            text-decoration: none;
            font-size: 17px;
        }
        .navbar-user-box {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .navbar-user-box img {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: 2px solid #9d4bff;
            object-fit: cover;
        }
    </style>
</head>

<body>

<!-- ================= NAVBAR UNIVERSAL ================= -->
<nav class="navbar">
    <div class="navbar-logo">Galería Virtual</div>

    <div class="navbar-links">
        <a href="inicio.html">Inicio</a>
        <a href="Sobre_nosotros.html">Nosotros</a>
        <a href="Contenido.html">Contenido</a>
        <a href="publicar.html">Publicar +</a>

        <a id="btnLogin" href="login.html">Iniciar sesión</a>

        <!-- Usuario -->
        <div id="navbarUserBox" class="navbar-user-box"></div>
    </div>
</nav>

<!-- ================= CONTENIDO ================= -->
<div class="cuenta-container">

    <h1>Mi Cuenta</h1>

    <!-- FOTO -->
    <img id="fotoPerfil" class="foto-perfil" src="img/default.png">

    <button id="btnCambiarFoto">Cambiar foto</button>
    <input type="file" id="nuevaFoto" accept="image/*" style="display:none">

    <!-- NOMBRE -->
    <div class="input-group">
        <label>Nombre:</label>
        <input type="text" id="nuevoNombre">
    </div>

    <!-- CORREO -->
    <div class="input-group">
        <label>Correo:</label>
        <input type="text" id="correoUsuario" readonly>
    </div>

    <button id="guardarCambios" class="btn-guardar">Guardar cambios</button>

    <button class="btn-salir" onclick="cerrarSesion()">Cerrar sesión</button>

</div>

<!-- ================= SCRIPT PRINCIPAL ================= -->
<script>
document.addEventListener("DOMContentLoaded", () => {

    const user = JSON.parse(localStorage.getItem("usuarioActivo"));

    if (!user) {
        location.href = "login.html";
        return;
    }

    // Cargar datos
    document.getElementById("fotoPerfil").src = user.foto || "img/default.png";
    document.getElementById("nuevoNombre").value = user.nombre || "";
    document.getElementById("correoUsuario").value = user.correo || "";

    // Cargar Usuario en el Navbar
    cargarUsuarioNavbar();
});

/* ------------------------------------------------------
   MOSTRAR USUARIO EN EL NAVBAR UNIVERSAL
------------------------------------------------------- */
function cargarUsuarioNavbar() {
    const usuario = JSON.parse(localStorage.getItem("usuarioActivo"));
    const box = document.getElementById("navbarUserBox");
    const loginBtn = document.getElementById("btnLogin");

    if (!usuario) {
        loginBtn.style.display = "inline-block";
        box.innerHTML = "";
        return;
    }

    loginBtn.style.display = "none";

    const foto = usuario.foto ? usuario.foto : "img/default.png";

    box.innerHTML = `
        <img src="${foto}">
        <span>${usuario.nombre}</span>
    `;

    box.onclick = () => location.href = "cuenta.html";
}


/* ------------------------------------------------------
   CAMBIAR FOTO
------------------------------------------------------- */
document.getElementById("btnCambiarFoto").addEventListener("click", () => {
    document.getElementById("nuevaFoto").click();
});

document.getElementById("nuevaFoto").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    if (file.size > 2 * 1024 * 1024) {
        alert("La imagen es demasiado grande. Máximo 2MB.");
        return;
    }

    const reader = new FileReader();

    reader.onload = () => {
        let user = JSON.parse(localStorage.getItem("usuarioActivo"));
        user.foto = reader.result;

        localStorage.setItem("usuarioActivo", JSON.stringify(user));

        document.getElementById("fotoPerfil").src = reader.result;

        const navFoto = document.querySelector("#navbarUserBox img");
        if (navFoto) navFoto.src = reader.result;

        alert("Foto actualizada correctamente");
    };

    reader.readAsDataURL(file);
});


/* ------------------------------------------------------
   GUARDAR NOMBRE
------------------------------------------------------- */
document.getElementById("guardarCambios").addEventListener("click", () => {

    let user = JSON.parse(localStorage.getItem("usuarioActivo"));

    const nuevoNombre = document.getElementById("nuevoNombre").value.trim();

    if (nuevoNombre.length < 2) {
        alert("El nombre es demasiado corto.");
        return;
    }

    user.nombre = nuevoNombre;

    localStorage.setItem("usuarioActivo", JSON.stringify(user));

    const span = document.querySelector("#navbarUserBox span");
    if (span) span.textContent = nuevoNombre;

    alert("Datos actualizados correctamente.");
});


/* ------------------------------------------------------
   CERRAR SESIÓN
------------------------------------------------------- */
function cerrarSesion() {
    localStorage.removeItem("usuarioActivo");
    location.href = "login.html";
}
</script>

</body>
</html>
